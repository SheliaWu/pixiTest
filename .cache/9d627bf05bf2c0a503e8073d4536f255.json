{"dependencies":[{"name":"I:\\nap\\pixi\\package.json","includedInParent":true,"mtime":1520872037604},{"name":"I:\\nap\\pixi\\.babelrc","includedInParent":true,"mtime":1520870313510},{"name":"I:\\nap\\pixi\\node_modules\\pixi.js\\package.json","includedInParent":true,"mtime":1516219849000},{"name":"../../renderers/webgl/utils/ObjectRenderer","loc":{"line":5,"column":31}},{"name":"../../renderers/webgl/WebGLRenderer","loc":{"line":9,"column":29}},{"name":"../../utils/createIndicesForQuads","loc":{"line":13,"column":37}},{"name":"./generateMultiTextureShader","loc":{"line":17,"column":42}},{"name":"../../renderers/webgl/utils/checkMaxIfStatmentsInShader","loc":{"line":21,"column":43}},{"name":"./BatchBuffer","loc":{"line":25,"column":27}},{"name":"../../settings","loc":{"line":29,"column":24}},{"name":"../../utils","loc":{"line":33,"column":21}},{"name":"pixi-gl-core","loc":{"line":35,"column":26}},{"name":"bit-twiddle","loc":{"line":39,"column":26}}],"generated":{"js":"\"use strict\";exports.__esModule=!0;var e=require(\"../../renderers/webgl/utils/ObjectRenderer\"),t=T(e),r=require(\"../../renderers/webgl/WebGLRenderer\"),i=T(r),s=require(\"../../utils/createIndicesForQuads\"),n=T(s),u=require(\"./generateMultiTextureShader\"),d=T(u),o=require(\"../../renderers/webgl/utils/checkMaxIfStatmentsInShader\"),a=T(o),h=require(\"./BatchBuffer\"),l=T(h),f=require(\"../../settings\"),v=T(f),x=require(\"../../utils\"),p=require(\"pixi-gl-core\"),c=T(p),_=require(\"bit-twiddle\"),b=T(_);function T(e){return e&&e.__esModule?e:{default:e}}function B(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function S(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function y(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var A=0,E=0,I=function(e){function t(r){B(this,t);var i=S(this,e.call(this,r));i.vertSize=5,i.vertByteSize=4*i.vertSize,i.size=v.default.SPRITE_BATCH_SIZE,i.buffers=[];for(var s=1;s<=b.default.nextPow2(i.size);s*=2)i.buffers.push(new l.default(4*s*i.vertByteSize));i.indices=(0,n.default)(i.size),i.shader=null,i.currentIndex=0,i.groups=[];for(var u=0;u<i.size;u++)i.groups[u]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return i.sprites=[],i.vertexBuffers=[],i.vaos=[],i.vaoMax=2,i.vertexCount=0,i.renderer.on(\"prerender\",i.onPrerender,i),i}return y(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),v.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,a.default)(this.MAX_TEXTURES,e)),this.shader=(0,d.default)(e,this.MAX_TEXTURES),this.indexBuffer=c.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.renderer.bindVao(null);for(var t=this.shader.attributes,r=0;r<this.vaoMax;r++){var i=this.vertexBuffers[r]=c.default.GLBuffer.createVertexBuffer(e,null,e.STREAM_DRAW),s=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(i,t.aVertexPosition,e.FLOAT,!1,this.vertByteSize,0).addAttribute(i,t.aTextureCoord,e.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(i,t.aColor,e.UNSIGNED_BYTE,!0,this.vertByteSize,12);t.aTextureId&&s.addAttribute(i,t.aTextureId,e.FLOAT,!1,this.vertByteSize,16),this.vaos[r]=s}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},t.prototype.onPrerender=function(){this.vertexCount=0},t.prototype.render=function(e){this.currentIndex>=this.size&&this.flush(),e._texture._uvs&&(this.sprites[this.currentIndex++]=e)},t.prototype.flush=function(){if(0!==this.currentIndex){var e=this.renderer.gl,t=this.MAX_TEXTURES,r=b.default.nextPow2(this.currentIndex),i=b.default.log2(r),s=this.buffers[i],n=this.sprites,u=this.groups,d=s.float32View,o=s.uint32View,a=this.boundTextures,h=this.renderer.boundTextures,l=this.renderer.textureGC.count,f=0,p=void 0,_=void 0,T=1,B=0,S=u[0],y=void 0,I=void 0,M=x.premultiplyBlendMode[n[0]._texture.baseTexture.premultipliedAlpha?1:0][n[0].blendMode];S.textureCount=0,S.start=0,S.blend=M,A++;var C=void 0;for(C=0;C<t;++C){var R=h[C];R._enabled!==A?(a[C]=R,R._virtalBoundId=C,R._enabled=A):a[C]=this.renderer.emptyTextures[C]}for(A++,C=0;C<this.currentIndex;++C){var z=n[C];p=z._texture.baseTexture;var U=x.premultiplyBlendMode[Number(p.premultipliedAlpha)][z.blendMode];if(M!==U&&(M=U,_=null,B=t,A++),_!==p&&(_=p,p._enabled!==A)){if(B===t&&(A++,S.size=C-S.start,B=0,(S=u[T++]).blend=M,S.textureCount=0,S.start=C),p.touched=l,-1===p._virtalBoundId)for(var g=0;g<t;++g){var w=(g+E)%t,X=a[w];if(X._enabled!==A){E++,X._virtalBoundId=-1,p._virtalBoundId=w,a[w]=p;break}}p._enabled=A,S.textureCount++,S.ids[B]=p._virtalBoundId,S.textures[B++]=p}if(y=z.vertexData,I=z._texture._uvs.uvsUint32,this.renderer.roundPixels){var P=this.renderer.resolution;d[f]=(y[0]*P|0)/P,d[f+1]=(y[1]*P|0)/P,d[f+5]=(y[2]*P|0)/P,d[f+6]=(y[3]*P|0)/P,d[f+10]=(y[4]*P|0)/P,d[f+11]=(y[5]*P|0)/P,d[f+15]=(y[6]*P|0)/P,d[f+16]=(y[7]*P|0)/P}else d[f]=y[0],d[f+1]=y[1],d[f+5]=y[2],d[f+6]=y[3],d[f+10]=y[4],d[f+11]=y[5],d[f+15]=y[6],d[f+16]=y[7];o[f+2]=I[0],o[f+7]=I[1],o[f+12]=I[2],o[f+17]=I[3];var m=Math.min(z.worldAlpha,1),N=m<1&&p.premultipliedAlpha?(0,x.premultiplyTint)(z._tintRGB,m):z._tintRGB+(255*m<<24);o[f+3]=o[f+8]=o[f+13]=o[f+18]=N,d[f+4]=d[f+9]=d[f+14]=d[f+19]=p._virtalBoundId,f+=20}if(S.size=C-S.start,v.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(s.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var O=this.shader.attributes,G=this.vertexBuffers[this.vertexCount]=c.default.GLBuffer.createVertexBuffer(e,null,e.STREAM_DRAW),D=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(G,O.aVertexPosition,e.FLOAT,!1,this.vertByteSize,0).addAttribute(G,O.aTextureCoord,e.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(G,O.aColor,e.UNSIGNED_BYTE,!0,this.vertByteSize,12);O.aTextureId&&D.addAttribute(G,O.aTextureId,e.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=D}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(s.vertices,0,!1),this.vertexCount++}for(C=0;C<t;++C)h[C]._virtalBoundId=-1;for(C=0;C<T;++C){for(var L=u[C],V=L.textureCount,q=0;q<V;q++)_=L.textures[q],h[L.ids[q]]!==_&&this.renderer.bindTexture(_,L.ids[q],!0),_._virtalBoundId=-1;this.renderer.state.setBlendMode(L.blend),e.drawElements(e.TRIANGLES,6*L.size,e.UNSIGNED_SHORT,6*L.start*2)}this.currentIndex=0}},t.prototype.start=function(){this.renderer.bindShader(this.shader),v.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var t=0;t<this.vaoMax;t++)this.vertexBuffers[t]&&this.vertexBuffers[t].destroy(),this.vaos[t]&&this.vaos[t].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off(\"prerender\",this.onPrerender,this),e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var r=0;r<this.buffers.length;++r)this.buffers[r].destroy()},t}(t.default);exports.default=I,i.default.registerPlugin(\"sprite\",I);"},"hash":"77f50e647b36382ef93d28cc22225ceb","cacheData":{"env":{}}}