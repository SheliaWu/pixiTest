{"dependencies":[{"name":"I:\\nap\\pixi\\package.json","includedInParent":true,"mtime":1520872037604},{"name":"I:\\nap\\pixi\\.babelrc","includedInParent":true,"mtime":1520870313510},{"name":"I:\\nap\\pixi\\node_modules\\pixi.js\\package.json","includedInParent":true,"mtime":1516219849000},{"name":"./WebGLManager","loc":{"line":5,"column":29}},{"name":"../utils/RenderTarget","loc":{"line":9,"column":28}},{"name":"../utils/Quad","loc":{"line":13,"column":20}},{"name":"../../../math","loc":{"line":17,"column":20}},{"name":"../../../Shader","loc":{"line":19,"column":22}},{"name":"../filters/filterTransforms","loc":{"line":23,"column":32}},{"name":"bit-twiddle","loc":{"line":27,"column":26}}],"generated":{"js":"\"use strict\";exports.__esModule=!0;var e=require(\"./WebGLManager\"),r=g(e),t=require(\"../utils/RenderTarget\"),a=g(t),i=require(\"../utils/Quad\"),n=g(i),s=require(\"../../../math\"),o=require(\"../../../Shader\"),l=g(o),d=require(\"../filters/filterTransforms\"),u=c(d),h=require(\"bit-twiddle\"),f=g(h);function c(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function g(e){return e&&e.__esModule?e:{default:e}}function p(e,r){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!r||\"object\"!=typeof r&&\"function\"!=typeof r?e:r}function T(e,r){if(\"function\"!=typeof r&&null!==r)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function m(e,r){if(!(e instanceof r))throw new TypeError(\"Cannot call a class as a function\")}var v=function e(){m(this,e),this.renderTarget=null,this.sourceFrame=new s.Rectangle,this.destinationFrame=new s.Rectangle,this.filters=[],this.target=null,this.resolution=1},x=function(e){function r(t){m(this,r);var a=p(this,e.call(this,t));return a.gl=a.renderer.gl,a.quad=new n.default(a.gl,t.state.attribState),a.shaderCache={},a.pool={},a.filterData=null,a.managedFilters=[],a}return T(r,e),r.prototype.pushFilter=function(e,r){var t=this.renderer,a=this.filterData;if(!a){a=this.renderer._activeRenderTarget.filterStack;var i=new v;i.sourceFrame=i.destinationFrame=this.renderer._activeRenderTarget.size,i.renderTarget=t._activeRenderTarget,this.renderer._activeRenderTarget.filterData=a={index:0,stack:[i]},this.filterData=a}var n=a.stack[++a.index];n||(n=a.stack[a.index]=new v);var s=r[0].resolution,o=0|r[0].padding,l=e.filterArea||e.getBounds(!0),d=n.sourceFrame,u=n.destinationFrame;d.x=(l.x*s|0)/s,d.y=(l.y*s|0)/s,d.width=(l.width*s|0)/s,d.height=(l.height*s|0)/s,a.stack[0].renderTarget.transform||r[0].autoFit&&d.fit(a.stack[0].destinationFrame),d.pad(o),u.width=d.width,u.height=d.height;var h=this.getPotRenderTarget(t.gl,d.width,d.height,s);n.target=e,n.filters=r,n.resolution=s,n.renderTarget=h,h.setFrame(u,d),t.bindRenderTarget(h),h.clear()},r.prototype.popFilter=function(){var e=this.filterData,r=e.stack[e.index-1],t=e.stack[e.index];this.quad.map(t.renderTarget.size,t.sourceFrame).upload();var a=t.filters;if(1===a.length)a[0].apply(this,t.renderTarget,r.renderTarget,!1,t),this.freePotRenderTarget(t.renderTarget);else{var i=t.renderTarget,n=this.getPotRenderTarget(this.renderer.gl,t.sourceFrame.width,t.sourceFrame.height,t.resolution);n.setFrame(t.destinationFrame,t.sourceFrame),n.clear();var s=0;for(s=0;s<a.length-1;++s){a[s].apply(this,i,n,!0,t);var o=i;i=n,n=o}a[s].apply(this,i,r.renderTarget,!1,t),this.freePotRenderTarget(i),this.freePotRenderTarget(n)}e.index--,0===e.index&&(this.filterData=null)},r.prototype.applyFilter=function(e,r,t,a){var i=this.renderer,n=i.gl,s=e.glShaders[i.CONTEXT_UID];s||(e.glShaderKey?(s=this.shaderCache[e.glShaderKey])||(s=new l.default(this.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[i.CONTEXT_UID]=this.shaderCache[e.glShaderKey]=s,this.managedFilters.push(e)):(s=e.glShaders[i.CONTEXT_UID]=new l.default(this.gl,e.vertexSrc,e.fragmentSrc),this.managedFilters.push(e)),i.bindVao(null),this.quad.initVao(s)),i.bindVao(this.quad.vao),i.bindRenderTarget(t),a&&(n.disable(n.SCISSOR_TEST),i.clear(),n.enable(n.SCISSOR_TEST)),t===i.maskManager.scissorRenderTarget&&i.maskManager.pushScissorMask(null,i.maskManager.scissorData),i.bindShader(s);var o=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=o,this.syncUniforms(s,e),i.state.setBlendMode(e.blendMode),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),n.bindTexture(n.TEXTURE_2D,o._glTextures[this.renderer.CONTEXT_UID].texture)},r.prototype.syncUniforms=function(e,r){var t=r.uniformData,a=r.uniforms,i=1,n=void 0;if(e.uniforms.filterArea){n=this.filterData.stack[this.filterData.index];var s=e.uniforms.filterArea;s[0]=n.renderTarget.size.width,s[1]=n.renderTarget.size.height,s[2]=n.sourceFrame.x,s[3]=n.sourceFrame.y,e.uniforms.filterArea=s}if(e.uniforms.filterClamp){n=n||this.filterData.stack[this.filterData.index];var o=e.uniforms.filterClamp;o[0]=0,o[1]=0,o[2]=(n.sourceFrame.width-1)/n.renderTarget.size.width,o[3]=(n.sourceFrame.height-1)/n.renderTarget.size.height,e.uniforms.filterClamp=o}for(var l in t){var d=t[l].type;if(\"sampler2d\"===d&&0!==a[l]){if(a[l].baseTexture)e.uniforms[l]=this.renderer.bindTexture(a[l].baseTexture,i);else{e.uniforms[l]=i;var u=this.renderer.gl;this.renderer.boundTextures[i]=this.renderer.emptyTextures[i],u.activeTexture(u.TEXTURE0+i),a[l].texture.bind()}i++}else if(\"mat3\"===d)void 0!==a[l].a?e.uniforms[l]=a[l].toArray(!0):e.uniforms[l]=a[l];else if(\"vec2\"===d)if(void 0!==a[l].x){var h=e.uniforms[l]||new Float32Array(2);h[0]=a[l].x,h[1]=a[l].y,e.uniforms[l]=h}else e.uniforms[l]=a[l];else\"float\"===d?e.uniforms.data[l].value!==t[l]&&(e.uniforms[l]=a[l]):e.uniforms[l]=a[l]}},r.prototype.getRenderTarget=function(e,r){var t=this.filterData.stack[this.filterData.index],a=this.getPotRenderTarget(this.renderer.gl,t.sourceFrame.width,t.sourceFrame.height,r||t.resolution);return a.setFrame(t.destinationFrame,t.sourceFrame),a},r.prototype.returnRenderTarget=function(e){this.freePotRenderTarget(e)},r.prototype.calculateScreenSpaceMatrix=function(e){var r=this.filterData.stack[this.filterData.index];return u.calculateScreenSpaceMatrix(e,r.sourceFrame,r.renderTarget.size)},r.prototype.calculateNormalizedScreenSpaceMatrix=function(e){var r=this.filterData.stack[this.filterData.index];return u.calculateNormalizedScreenSpaceMatrix(e,r.sourceFrame,r.renderTarget.size,r.destinationFrame)},r.prototype.calculateSpriteMatrix=function(e,r){var t=this.filterData.stack[this.filterData.index];return u.calculateSpriteMatrix(e,t.sourceFrame,t.renderTarget.size,r)},r.prototype.destroy=function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.renderer,t=this.managedFilters,a=0;a<t.length;a++)e||t[a].glShaders[r.CONTEXT_UID].destroy(),delete t[a].glShaders[r.CONTEXT_UID];this.shaderCache={},e?this.pool={}:this.emptyPool()},r.prototype.getPotRenderTarget=function(e,r,t,i){var n=(65535&(r=f.default.nextPow2(r*i)))<<16|65535&(t=f.default.nextPow2(t*i));this.pool[n]||(this.pool[n]=[]);var s=this.pool[n].pop();if(!s){var o=this.renderer.boundTextures[0];e.activeTexture(e.TEXTURE0),s=new a.default(e,r,t,null,1),e.bindTexture(e.TEXTURE_2D,o._glTextures[this.renderer.CONTEXT_UID].texture)}return s.resolution=i,s.defaultFrame.width=s.size.width=r/i,s.defaultFrame.height=s.size.height=t/i,s},r.prototype.emptyPool=function(){for(var e in this.pool){var r=this.pool[e];if(r)for(var t=0;t<r.length;t++)r[t].destroy(!0)}this.pool={}},r.prototype.freePotRenderTarget=function(e){var r=(65535&e.size.width*e.resolution)<<16|65535&e.size.height*e.resolution;this.pool[r].push(e)},r}(r.default);exports.default=x;"},"hash":"9f288d8334bd6b78e6dcfc8439666b60","cacheData":{"env":{}}}