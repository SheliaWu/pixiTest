{"dependencies":[{"name":"I:\\nap\\pixi\\package.json","includedInParent":true,"mtime":1520872037604},{"name":"I:\\nap\\pixi\\.babelrc","includedInParent":true,"mtime":1520870313510},{"name":"I:\\nap\\pixi\\node_modules\\pixi.js\\package.json","includedInParent":true,"mtime":1516219849000},{"name":"../../core","loc":{"line":5,"column":20}},{"name":"./ParticleShader","loc":{"line":9,"column":30}},{"name":"./ParticleBuffer","loc":{"line":13,"column":30}},{"name":"../../core/utils","loc":{"line":17,"column":21}}],"generated":{"js":"\"use strict\";exports.__esModule=!0;var e=require(\"../../core\"),t=u(e),r=require(\"./ParticleShader\"),o=s(r),i=require(\"./ParticleBuffer\"),n=s(i),a=require(\"../../core/utils\");function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function l(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function h(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=function(e){function r(o){p(this,r);var i=l(this,e.call(this,o));return i.shader=null,i.indexBuffer=null,i.properties=null,i.tempMatrix=new t.Matrix,i.CONTEXT_UID=0,i}return h(r,e),r.prototype.onContextChange=function(){var e=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new o.default(e),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},r.prototype.start=function(){this.renderer.bindShader(this.shader)},r.prototype.render=function(e){var r=e.children,o=e._maxSize,i=e._batchSize,n=this.renderer,a=r.length;if(0!==a){a>o&&(a=o);var s=e._glBuffers[n.CONTEXT_UID];s||(s=e._glBuffers[n.CONTEXT_UID]=this.generateBuffers(e));var u=r[0]._texture.baseTexture;this.renderer.setBlendMode(t.utils.correctBlendMode(e.blendMode,u.premultipliedAlpha));var p=n.gl,l=e.worldTransform.copy(this.tempMatrix);l.prepend(n._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=l.toArray(!0),this.shader.uniforms.uColor=t.utils.premultiplyRgba(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,u.premultipliedAlpha),this.shader.uniforms.uSampler=n.bindTexture(u);for(var h=0,f=0;h<a;h+=i,f+=1){var d=a-h;if(d>i&&(d=i),f>=s.length){if(!e.autoResize)break;s.push(this._generateOneMoreBuffer(e))}var c=s[f];c.uploadDynamic(r,h,d),e._bufferToUpdate===f&&(c.uploadStatic(r,h,d),e._bufferToUpdate=f+1),n.bindVao(c.vao),c.vao.draw(p.TRIANGLES,6*d)}}},r.prototype.generateBuffers=function(e){for(var t=this.renderer.gl,r=[],o=e._maxSize,i=e._batchSize,a=e._properties,s=0;s<o;s+=i)r.push(new n.default(t,this.properties,a,i));return r},r.prototype._generateOneMoreBuffer=function(e){var t=this.renderer.gl,r=e._batchSize,o=e._properties;return new n.default(t,this.properties,o,r)},r.prototype.uploadVertices=function(e,t,r,o,i,n){for(var a=0,s=0,u=0,p=0,l=0;l<r;++l){var h=e[t+l],f=h._texture,d=h.scale.x,c=h.scale.y,y=f.trim,b=f.orig;y?(a=(s=y.x-h.anchor.x*b.width)+y.width,u=(p=y.y-h.anchor.y*b.height)+y.height):(a=b.width*(1-h.anchor.x),s=b.width*-h.anchor.x,u=b.height*(1-h.anchor.y),p=b.height*-h.anchor.y),o[n]=s*d,o[n+1]=p*c,o[n+i]=a*d,o[n+i+1]=p*c,o[n+2*i]=a*d,o[n+2*i+1]=u*c,o[n+3*i]=s*d,o[n+3*i+1]=u*c,n+=4*i}},r.prototype.uploadPosition=function(e,t,r,o,i,n){for(var a=0;a<r;a++){var s=e[t+a].position;o[n]=s.x,o[n+1]=s.y,o[n+i]=s.x,o[n+i+1]=s.y,o[n+2*i]=s.x,o[n+2*i+1]=s.y,o[n+3*i]=s.x,o[n+3*i+1]=s.y,n+=4*i}},r.prototype.uploadRotation=function(e,t,r,o,i,n){for(var a=0;a<r;a++){var s=e[t+a].rotation;o[n]=s,o[n+i]=s,o[n+2*i]=s,o[n+3*i]=s,n+=4*i}},r.prototype.uploadUvs=function(e,t,r,o,i,n){for(var a=0;a<r;++a){var s=e[t+a]._texture._uvs;s?(o[n]=s.x0,o[n+1]=s.y0,o[n+i]=s.x1,o[n+i+1]=s.y1,o[n+2*i]=s.x2,o[n+2*i+1]=s.y2,o[n+3*i]=s.x3,o[n+3*i+1]=s.y3,n+=4*i):(o[n]=0,o[n+1]=0,o[n+i]=0,o[n+i+1]=0,o[n+2*i]=0,o[n+2*i+1]=0,o[n+3*i]=0,o[n+3*i+1]=0,n+=4*i)}},r.prototype.uploadTint=function(e,t,r,o,i,n){for(var s=0;s<r;++s){var u=e[t+s],p=u._texture.baseTexture.premultipliedAlpha,l=u.alpha,h=l<1&&p?(0,a.premultiplyTint)(u._tintRGB,l):u._tintRGB+(255*l<<24);o[n]=h,o[n+i]=h,o[n+2*i]=h,o[n+3*i]=h,n+=4*i}},r.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),e.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},r}(t.ObjectRenderer);exports.default=f,t.WebGLRenderer.registerPlugin(\"particle\",f);"},"hash":"c2a47d72346f8d5ee0a2eff2ca8ecdc6","cacheData":{"env":{}}}